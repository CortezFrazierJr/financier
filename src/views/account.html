<div class="account" st-table="accountCtrl.transactions" disable-ng-animate>
  <div class="account__tbody">
    <div class="account__tr account__tr--overview">
      <div class="account__name" ng-click="dbCtrl.editAccount(accountCtrl.account)">{{accountCtrl.account.name}}</div>
      <div class="account__balance">
        <div>
          <div class="account__balance-title">Cleared balance</div>
          <div class="account__balance-value">{{accountCtrl.account.cache.clearedBalance | intCurrency | currency}}</div>
        </div>
      </div>
      <div class="account__operator">+</div>
      <div class="account__balance">
        <div>
          <div class="account__balance-title">Uncleared balance</div>
          <div class="account__balance-value">{{accountCtrl.account.cache.unclearedBalance | intCurrency | currency}}</div>
        </div>
      </div>
      <div class="account__operator">=</div>
      <div class="account__balance">
        <div>
          <div class="account__balance-title">Working balance</div>
          <div class="account__balance-value">{{accountCtrl.account.cache.balance | intCurrency | currency}}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="account__tbody">
    <div class="account__tr">
      <button class="account__add-button" ng-click="accountCtrl.createTransaction()"><i class="fa fa-plus"></i> Add a new transaction</button>
      <button class="account__add-button"><i class="fa fa-exchange"></i> Make a transfer</button>

      <button class="account__add-button" ng-if="accountCtrl.selectedTransactions.length" bulk-edit-transactions="accountCtrl.selectedTransactions"><i class="fa fa-edit"></i> Edit ({{accountCtrl.selectedTransactions.length}}) <i class="fa fa-sort-desc"></i></button>
    </div>
  </div>
  <div class="account__thead" ng-click="$event.stopPropagation()">
    <div class="account__tr">
      <div class="account__th account__th--select">
        <input type="checkbox" ng-model="accountCtrl.isAllSelected" ng-model-options="{ getterSetter: true }">
      </div>
      <div class="account__th" ng-if="!accountCtrl.accountId" st-sort="account"><span>Account</span></div>
      <div class="account__th account__th--flag"><div class="account__header-flag"><div></div></div></div>
      <div class="account__th" st-sort="date" st-sort-default="reverse"><span>Date</span></div>
      <div class="account__th" st-sort="payee"><span>Payee</span></div>
      <div class="account__th" st-sort="category"><span>Category</span></div>
      <div class="account__th account__cell-memo"><span>Memo</span></div>
      <div class="account__th account__cell-inflow" st-sort="inflow"><span>Inflow</span></div>
      <div class="account__th account__cell-outflow" st-sort="outflow"><span>Outflow</span></div>
      <div class="account__th account__cell-cleared" st-sort="cleared"><span>Cleared</span></div>
    </div>
  </div>
  <div class="account__tbody" infinite-scroll="accountCtrl.viewMore()">
    <div class="account__tr"
         ng-repeat-start="transaction in accountCtrl.transactions track by transaction.id"
         ng-if="accountCtrl.editingTransaction !== transaction"
         ng-click="accountCtrl.selectRow($event, $index)"
         ng-class="{'st-selected': accountCtrl.isTransactionSelected(transaction)}">
      <div class="account__td account__td--select" ng-click="accountCtrl.toggle($index, $event)">
        <input type="checkbox" ng-model="accountCtrl.selectGetterSetter(transaction)" ng-model-options="{ getterSetter: true }">
      </div>
      <div class="account__td" ng-if="!accountCtrl.accountId">{{:: transaction.account}}</div>
      <div class="account__td account__td--flag"><div class="account__flag" ng-style="{'color': transaction.flag}" flag ng-model="transaction.flag"><div></div></div></div>
      <div class="account__td">{{:: transaction.date | date}}</div>
      <div class="account__td">{{:: transaction.payee}}</div>
      <div class="account__td">{{:: transaction.category}}</div>
      <div class="account__td account__cell-memo">{{:: transaction.memo}}</div>
      <div class="account__td account__cell-inflow">{{:: transaction.inflow | intCurrency | currency}}</div>
      <div class="account__td account__cell-outflow">{{:: transaction.outflow | intCurrency | currency}}</div>
      <div class="account__td account__cell-cleared"><div class="cleared" ng-class="{'cleared--true': transaction.cleared}" ng-click="accountCtrl.setCleared($event, transaction)">C</div></div>
    </div>

    <div ng-repeat-end ng-if="accountCtrl.editingTransaction === transaction"
         class="account__tr account__tr--editing"
         hotkey="{esc: accountCtrl.stopEditing}"
         ng-click="$event.stopPropagation()">
      <div class="account__td account__td--select" ng-click="accountCtrl.toggle($index, $event)">
        <input type="checkbox" ng-model="accountCtrl.selectGetterSetter(transaction)" ng-model-options="{ getterSetter: true }">
      </div>
      <div class="account__td" ng-if="!accountCtrl.accountId">{{transaction.account}}</div>
      <div class="account__td account__td--flag"><div class="account__flag" ng-style="{'color': transaction.flag}" flag ng-model="transaction.flag"><div></div></div></div>
      <div class="account__td">{{transaction.date | date}}</div>
      <div class="account__td">{{transaction.payee}}</div>
      <div class="account__td">{{transaction.category}}</div>
      <div class="account__td account__cell-memo">{{transaction.memo}}</div>
      <div class="account__td account__cell-inflow">
        <input type="text" ng-model="transaction.inflow">
      </div>
      <div class="account__td account__cell-outflow">
        <input type="text" ng-model="transaction.outflow">
      </div>
      <div class="account__td account__cell-cleared"><div class="cleared" ng-class="{'cleared--true': transaction.cleared}" ng-click="accountCtrl.setCleared($event, transaction)">C</div></div>

      <ul class="account__editing-buttons">
        <li class="account__editing-button account__editing-button--save">Save</li><li class="account__editing-button" ng-click="accountCtrl.stopEditing()">Cancel</li>
      </ul>

    </div>
    <br><br><br>
  </div>
</div>

